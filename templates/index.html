{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Liste des Projets</h1>

    <a href="{{ url_for('ajouter_projet') }}" class="btn btn-success mb-3">+ Ajouter un projet</a>

    {% if projets %}
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Nom du projet</th>
                <th>Client</th>
                <th>Description</th>
                <th>Responsable</th>
                <th>Semaine prévue</th>
                <th>Statut</th>
                <th>Modules</th>
                <th>Avancement</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for projet in projets %}
            <tr>
                <td>{{ projet.nom }}</td>
                <td>{{ projet.client or '-' }}</td>
                <td>{{ projet.description or '-' }}</td>
                <td>{{ projet.responsable or '-' }}</td>
                <td>{{ projet.semaine_prevue or '-' }}</td>
                <td>{{ projet.statut }}</td>
                <td>{{ projet.modules|length }}</td>
                <td>
                    <div class="progress" style="height:20px;">
                        <div class="progress-bar bg-success" role="progressbar"
                             style="width: {{ projet.pourcentage_global() }}%;"
                             aria-valuenow="{{ projet.pourcentage_global() }}"
                             aria-valuemin="0" aria-valuemax="100">
                             {{ projet.pourcentage_global() }}%
                        </div>
                    </div>
                </td>
                <td>
                    <a class="btn btn-primary btn-sm" href="{{ url_for('projet', projet_id=projet.id) }}">Voir</a>
                    <a href="{{ url_for('modifier_projet', projet_id=projet.id) }}" class="btn btn-warning btn-sm">Modifier</a>
                    <form method="POST" action="{{ url_for('supprimer_projet', projet_id=projet.id) }}" style="display:inline;" onsubmit="return confirm('Voulez-vous vraiment supprimer ce projet ?');">
                        <button type="submit" class="btn btn-danger btn-sm">Supprimer</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">Aucun projet pour le moment. Cliquez sur "Ajouter un projet" pour commencer.</p>
    {% endif %}
</div>

<footer class="text-center mt-5 mb-3 text-muted">
    &copy; {{ now().year }} ID Logistics — Tous droits réservés | Développé pour le suivi des tests
</footer>
{% endblock %}